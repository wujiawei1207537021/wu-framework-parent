"use strict";(self.webpackChunklazy_ui=self.webpackChunklazy_ui||[]).push([[2372],{72372:function(e,a,l){l.r(a),l.d(a,{default:function(){return s}});var t=l(66252),u=l(2262);const n=(0,t._)("span",null,"备份数据库",-1);var s={__name:"DatabaseSchemaBackUpsAdd",props:{showDialog:{type:Boolean,default:!0},title:{type:String,default:"数据库备份"},rowData:{type:Object,default:null}},emits:["closeDialog"],setup(e,{emit:a}){const l={instanceId:[{required:!0,message:"请选择数据库实例",trigger:"blur"}],schemaName:[{required:!0,message:"请选择数据库",trigger:"blur"}]},s=e,d=a,{title:o,rowData:i}=(0,u.BK)(s),c=()=>{d("closeDialog",!1)},r=(0,u.iH)(null),m=(0,u.iH)(null),v=(0,u.iH)(null),p=(0,u.iH)(null),f=(0,u.iH)(null),h=(0,u.qj)({hidden:!0,percentage:0,status:"success"}),g=(0,u.qj)({instanceId:"",schemaName:""});i.value&&(p.value=i.value.instanceId);const b=async e=>{let a;if(null==e)return;a=await VE_API.system.schemaList({instanceId:e});const{code:l,data:t}=a;return 0===l?(t.map((e=>{e.label=e.schemaName,e.value=e.schemaName})),v.value=t,v.value&&(f.value=v.value[0].schemaName),v.value):void 0};return(0,t.bv)((async()=>{await(async()=>{VE_API.system.databaseInstanceList().then((e=>(e.data.map((e=>{e.label=e.instanceName,e.value=e.id})),m.value=e.data?e.data:[],m.value&&m.value.length>0&&(p.value=m.value[0].id,b(p.value)),m.value)))})()})),(a,s)=>{const d=(0,t.up)("el-option"),i=(0,t.up)("el-select"),w=(0,t.up)("el-form-item"),y=(0,t.up)("el-form"),_=(0,t.up)("el-progress"),k=(0,t.up)("el-button"),I=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(I,{title:(0,u.SU)(o),"append-to-body":"","destroy-on-close":"","model-value":e.showDialog,onClose:s[4]||(s[4]=e=>c())},{footer:(0,t.w5)((()=>[(0,t._)("span",null,[(0,t.Wm)(k,{onClick:s[2]||(s[2]=e=>c())},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(k,{type:"primary",onClick:s[3]||(s[3]=e=>(g.schemaName=f.value,g.instanceId=p.value,void r.value.validate((async e=>{if(!e)return console.log("error submit!!"),!1;{h.hidden=!1,setInterval((()=>{h.percentage=h.percentage%100+10}),500);let e=await VE_API.system.databaseSchemaBackUp({instanceId:p.value,schemaName:f.value});const{code:a}=e;0===a&&(h.status="success",c())}}))))},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(y,{model:g,ref_key:"formRef",ref:r,rules:l,"label-width":"120px",inline:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{label:"数据库实例",prop:"instanceId"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=e=>p.value=e),placeholder:"数据库实例",onChange:b,filterable:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(m.value,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(w,{label:"数据库名",prop:"schemaName"},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{clearable:"",filterable:"",modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=e=>f.value=e),placeholder:"数据库名"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(v.value,(e=>((0,t.wg)(),(0,t.j4)(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"]),(0,t.Wm)(_,{"text-inside":!0,"stroke-width":24,percentage:h.percentage,hidden:h.hidden,status:h.status},{default:(0,t.w5)((()=>[n])),_:1},8,["percentage","hidden","status"])])),_:1},8,["title","model-value"])}}}}}]);