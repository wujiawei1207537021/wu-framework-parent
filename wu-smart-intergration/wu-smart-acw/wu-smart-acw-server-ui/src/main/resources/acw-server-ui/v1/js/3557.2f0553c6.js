"use strict";(self.webpackChunklazy_ui=self.webpackChunklazy_ui||[]).push([[3557],{93557:function(e,a,l){l.r(a),l.d(a,{default:function(){return d}});var u=l(66252),t=l(2262);var d={__name:"DatabaseTableAutoStuffedEdit",props:{showDialog:{type:Boolean,default:!0},title:{type:String,default:"添加"},rowData:{type:Object,default:null}},emits:["closeDialog"],setup(e,{emit:a}){const l={databaseSchemaId:[{required:!0,message:"请输入数据库库名",trigger:"blur"}],instanceId:[{required:!0,message:"请输入数据库服务器",trigger:"blur"}]},d=e,o=a,{title:n,rowData:m}=(0,t.BK)(d),s=()=>{o("closeDialog",!1)},i=(0,t.iH)(null),v=(0,t.qj)({schemaName:"",databaseSchemaId:"",instanceId:"",instanceName:"",autoStuffedNum:"",status:!1,tableNameList:[],id:""}),{id:c,schemaName:r,databaseSchemaId:b,instanceId:p,instanceName:f,autoStuffedNum:h,status:g,tableNameList:w}=(0,t.BK)(v),N=(0,t.iH)(null),_=(0,t.iH)(null),y=(0,t.iH)([]),V=(0,t.iH)(!1);m.value&&(c.value=m.value.id,r.value=m.value.schemaName,b.value=m.value.databaseSchemaId,p.value=m.value.instanceId,f.value=m.value.instanceName,h.value=m.value.autoStuffedNum,g.value=m.value.status,w.value=[m.value.tableName]),(0,u.bv)((async()=>{I()}));const I=()=>{VE_API.system.databaseInstanceList().then((e=>{e.data.map((e=>{e.label=e.instanceName,e.value=e.id})),N.value=e.data?e.data:[]}))},S=()=>{let e=y.value.find((e=>e.schemaNameId===b.value));console.log(e),e&&(f.value=e.instanceName,r.value=e.schemaName)};return(a,d)=>{const o=(0,u.up)("el-option"),c=(0,u.up)("el-select"),b=(0,u.up)("el-form-item"),f=(0,u.up)("el-checkbox"),g=(0,u.up)("el-input"),I=(0,u.up)("el-form"),k=(0,u.up)("el-button"),U=(0,u.up)("el-dialog");return(0,u.wg)(),(0,u.j4)(U,{title:(0,t.SU)(n),"append-to-body":"","destroy-on-close":"","model-value":e.showDialog,onClose:d[10]||(d[10]=e=>s())},{footer:(0,u.w5)((()=>[(0,u._)("span",null,[(0,u.Wm)(k,{onClick:d[8]||(d[8]=e=>s())},{default:(0,u.w5)((()=>[(0,u.Uk)("取消")])),_:1}),(0,u.Wm)(k,{type:"primary",onClick:d[9]||(d[9]=e=>{i.value.validate((async e=>{if(!e)return console.log("error submit!!"),!1;{let e;"添加自动填充记录"===n.value?(console.log(v),e=await VE_API.system.tableAutoStuffedRecordBatchAdd(v)):e=await VE_API.system.tableAutoStuffedRecordEdit({id:m.value.id,...v});const{code:a}=e;0===a&&s()}}))})},{default:(0,u.w5)((()=>[(0,u.Uk)("确定")])),_:1})])])),default:(0,u.w5)((()=>[(0,u.Wm)(I,{model:v,ref_key:"formRef",ref:i,rules:l,"label-width":"80px",inline:!1},{default:(0,u.w5)((()=>[(0,u.Wm)(b,{label:"数据库实例",prop:"instanceId"},{default:(0,u.w5)((()=>[(0,u.Wm)(c,{modelValue:(0,t.SU)(p),"onUpdate:modelValue":d[0]||(d[0]=e=>(0,t.dq)(p)?p.value=e:null),placeholder:"数据库实例",filterable:"",onChange:d[1]||(d[1]=e=>((e=null)=>{console.log(e),VE_API.system.schemaList({instanceId:p.value}).then((e=>{e.data.map((e=>{e.label=e.schemaName,e.value=e.schemaName})),_.value=e.data?e.data:[]}))})(e))},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(N.value,(e=>((0,u.wg)(),(0,u.j4)(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(b,{label:"数据库库名",prop:"schemaName"},{default:(0,u.w5)((()=>[(0,u.Wm)(c,{modelValue:(0,t.SU)(r),"onUpdate:modelValue":d[2]||(d[2]=e=>(0,t.dq)(r)?r.value=e:null),filterable:"",placeholder:"数据库实例",onChange:d[3]||(d[3]=e=>{VE_API.system.tableList({instanceId:p.value,schemaName:r.value}).then((e=>{e.data&&(e.data.map((e=>{e.label=e.tableName,e.value=e.tableName})),y.value=e.data?e.data:[])}))})},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(_.value,(e=>((0,u.wg)(),(0,u.j4)(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(b,{label:"表名称",prop:"tableNameList"},{default:(0,u.w5)((()=>[(0,u.Wm)(c,{modelValue:(0,t.SU)(w),"onUpdate:modelValue":d[6]||(d[6]=e=>(0,t.dq)(w)?w.value=e:null),placeholder:"表名称",onChange:S,filterable:"",multiple:""},{default:(0,u.w5)((()=>[(0,u.Wm)(f,{modelValue:V.value,"onUpdate:modelValue":d[4]||(d[4]=e=>V.value=e),indeterminate:(0,t.SU)(w).length!==y.value.length,onChange:d[5]||(d[5]=e=>(console.log(V.value),void(V.value?(V.value=!1,w.value=[]):(V.value=!0,w.value=y.value.map((e=>e.tableName)))))),style:{"margin-left":"20px"}},{default:(0,u.w5)((()=>[(0,u.Uk)(" 全选 ")])),_:1},8,["modelValue","indeterminate"]),((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(y.value,(e=>((0,u.wg)(),(0,u.j4)(o,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(b,{label:"自动填充数量",prop:"autoStuffedNum"},{default:(0,u.w5)((()=>[(0,u.Wm)(g,{modelValue:(0,t.SU)(h),"onUpdate:modelValue":d[7]||(d[7]=e=>(0,t.dq)(h)?h.value=e:null),placeholder:"",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","model-value"])}}}}}]);