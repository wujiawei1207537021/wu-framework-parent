"use strict";(self.webpackChunklazy_ui=self.webpackChunklazy_ui||[]).push([[9363],{39363:function(e,l,a){a.r(l),a.d(l,{default:function(){return o}});var u=a(66252),t=a(2262);var o={__name:"AcwTableAssociationRelationEdit",props:{showDialog:{type:Boolean,default:!0},title:{type:String,default:"添加"},rowData:{type:Object,default:null}},emits:["closeDialog"],setup(e,{emit:l}){const a={instanceId:[{required:!0,message:"请输入服务器名称",trigger:"blur"}],schema:[{required:!0,message:"请输入账户",trigger:"blur"}],sourceTable:[{required:!0,message:"请输入密码",trigger:"blur"}],sourceColumn:[{required:!0,message:"host不能为空",trigger:"change"}],relationTable:[{required:!0,message:"端口不能为空",trigger:"change"}],relationTableColumn:[{required:!0,message:"driverClassName",trigger:"change"}]},o=e,n=l,{title:d,rowData:m}=(0,t.BK)(o),r=()=>{n("closeDialog",!1)},s=(0,t.iH)(null),i=(0,t.qj)({instanceId:"",schema:"",sourceTable:"",sourceColumn:"",relationTable:"",relationTableColumn:"",type:2}),{instanceId:c,schema:v,sourceTable:b,sourceColumn:p,relationTable:w,relationTableColumn:g,type:f}=(0,t.BK)(i);m.value&&(c.value=m.value.instanceId,v.value=m.value.schema,b.value=m.value.sourceTable,p.value=m.value.sourceColumn,w.value=m.value.relationTable,g.value=m.value.relationTableColumn,f.value=m.value.type);const y=(0,t.iH)(null),h=(0,t.iH)(null),_=(0,t.iH)([]),V=(0,t.iH)(null),C=async()=>{let e=await VE_API.system.schemaList({instanceId:c.value});const{code:l}=e;0===l&&e.data&&(e.data.map((e=>{e.label=e.schemaName,e.value=e.schemaName})),y.value=e.data?e.data:[])},T=async()=>{let e;if(null==c.value)return;e=await VE_API.system.tableList({instanceId:c.value,schemaName:v.value});const{code:l,data:a}=e;0===l&&a&&(a.map((e=>{e.label=e.tableName,e.value=e.tableName})),h.value=a)},U=async e=>{_.value=[];let l=await VE_API.system.findDatabaseTableColumnList({instanceId:c.value,schemaName:v.value,tableName:e});const{code:a,data:u}=l;0===a&&(u.map((e=>{e.label=e.columnName,e.value=e.columnName})),_.value=u||[])};(0,u.bv)((async()=>{await(async()=>{VE_API.system.databaseInstanceList().then((e=>{e.data.map((e=>{e.label=e.instanceName,e.value=e.id})),V.value=e.data?e.data:[]}))})()}));return(l,o)=>{const n=(0,u.up)("el-option"),W=(0,u.up)("el-select"),I=(0,u.up)("el-form-item"),k=(0,u.up)("el-form"),q=(0,u.up)("el-button"),D=(0,u.up)("el-dialog");return(0,u.wg)(),(0,u.j4)(D,{title:(0,t.SU)(d),"append-to-body":"","destroy-on-close":"","model-value":e.showDialog,onClose:o[11]||(o[11]=e=>r())},{footer:(0,u.w5)((()=>[(0,u._)("span",null,[(0,u.Wm)(q,{onClick:o[9]||(o[9]=e=>r())},{default:(0,u.w5)((()=>[(0,u.Uk)("取消")])),_:1}),(0,u.Wm)(q,{type:"primary",onClick:o[10]||(o[10]=e=>{s.value.validate((async e=>{if(!e)return console.log("error submit!!"),!1;{let e;e="添加"===d.value?await VE_API.system.acwTableAssociationRelationStory(i):await VE_API.system.acwTableAssociationRelationStory({id:m.value.id,...i});const{code:l}=e;0===l&&r()}}))})},{default:(0,u.w5)((()=>[(0,u.Uk)("确定")])),_:1})])])),default:(0,u.w5)((()=>[(0,u.Wm)(k,{model:i,ref_key:"formRef",ref:s,rules:a,"label-width":"120px",inline:!1},{default:(0,u.w5)((()=>[(0,u.Wm)(I,{label:"数据库实例ID",prop:"instanceId"},{default:(0,u.w5)((()=>[(0,u.Wm)(W,{modelValue:(0,t.SU)(c),"onUpdate:modelValue":o[0]||(o[0]=e=>(0,t.dq)(c)?c.value=e:null),onChange:C,placeholder:"数据库实例",filterable:""},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(V.value,(e=>((0,u.wg)(),(0,u.j4)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(I,{label:"数据库实例schema",prop:"schema"},{default:(0,u.w5)((()=>[(0,u.Wm)(W,{modelValue:(0,t.SU)(v),"onUpdate:modelValue":o[1]||(o[1]=e=>(0,t.dq)(v)?v.value=e:null),placeholder:"数据库名",onChange:T,filterable:""},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(y.value,(e=>((0,u.wg)(),(0,u.j4)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(I,{label:"原始表",prop:"sourceTable"},{default:(0,u.w5)((()=>[(0,u.Wm)(W,{modelValue:(0,t.SU)(b),"onUpdate:modelValue":o[2]||(o[2]=e=>(0,t.dq)(b)?b.value=e:null),placeholder:"数据库表名",onChange:o[3]||(o[3]=e=>U((0,t.SU)(b))),filterable:""},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(h.value,(e=>((0,u.wg)(),(0,u.j4)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(I,{label:"原始表字段",prop:"sourceColumn"},{default:(0,u.w5)((()=>[(0,u.Wm)(W,{modelValue:(0,t.SU)(p),"onUpdate:modelValue":o[4]||(o[4]=e=>(0,t.dq)(p)?p.value=e:null),placeholder:"原始表字段",filterable:""},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(_.value,(e=>((0,u.wg)(),(0,u.j4)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(I,{label:"关系表",prop:"relationTable"},{default:(0,u.w5)((()=>[(0,u.Wm)(W,{modelValue:(0,t.SU)(w),"onUpdate:modelValue":o[5]||(o[5]=e=>(0,t.dq)(w)?w.value=e:null),placeholder:"关系表",onChange:o[6]||(o[6]=e=>U((0,t.SU)(w))),filterable:""},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(h.value,(e=>((0,u.wg)(),(0,u.j4)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(I,{label:"关系表字段",prop:"relationTableColumn"},{default:(0,u.w5)((()=>[(0,u.Wm)(W,{modelValue:(0,t.SU)(g),"onUpdate:modelValue":o[7]||(o[7]=e=>(0,t.dq)(g)?g.value=e:null),placeholder:"关系表字段",filterable:""},{default:(0,u.w5)((()=>[((0,u.wg)(!0),(0,u.iD)(u.HY,null,(0,u.Ko)(_.value,(e=>((0,u.wg)(),(0,u.j4)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,u.Wm)(I,{label:"类型(1:自动产生的、2:手动添加的)",prop:"type"},{default:(0,u.w5)((()=>[(0,u.Wm)(W,{modelValue:(0,t.SU)(f),"onUpdate:modelValue":o[8]||(o[8]=e=>(0,t.dq)(f)?f.value=e:null),placeholder:"类型(1:自动产生的、2:手动添加的)",clearable:""},{default:(0,u.w5)((()=>[(0,u.Wm)(n,{label:"自动产生的",value:1}),(0,u.Wm)(n,{label:"手动添加的",value:2})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","model-value"])}}}}}]);