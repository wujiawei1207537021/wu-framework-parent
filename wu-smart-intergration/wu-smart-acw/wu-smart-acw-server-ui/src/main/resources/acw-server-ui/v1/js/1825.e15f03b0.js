"use strict";(self.webpackChunklazy_ui=self.webpackChunklazy_ui||[]).push([[1825],{1825:function(e,a,l){l.r(a),l.d(a,{default:function(){return W}});l(70560);var t=l(66252),o=l(2262),u=l(49963),n=l(3577),i=l(22201),r=l(65781);const d=e=>((0,t.dD)("data-v-90f2bb06"),e=e(),(0,t.Cn)(),e),c={key:0},m={key:1},s={style:{height:"300px"}},p={key:0},v={key:1},w=d((()=>(0,t._)("span",null,"请求参数",-1))),y=d((()=>(0,t._)("span",null,"key",-1))),A=d((()=>(0,t._)("span",null,"请求头",-1))),h=d((()=>(0,t._)("span",null,"key",-1)));var f={__name:"AutomationEdit",props:{showDialog:{type:Boolean,default:!0},title:{type:String,default:"添加"},rowData:{type:Object,default:null}},emits:["closeDialog"],setup(e,{emit:a}){const d={name:[{required:!0,message:"请输入名称",trigger:"blur"}]},f=e,W=a,{title:_,rowData:V}=(0,o.BK)(f),k=(0,o.iH)(null),b=()=>{W("closeDialog",!1)},N=(0,o.iH)({showWhat:"info",automation:{},nodeList:[],node:{drawer:!1},showNodeOrAction:"node",currentNode:{},currentAction:{id:"",paramList:[],params:{},headerList:[],headers:{},result:""}}),U=async()=>{let e={automationId:N.value.automation.id,actionType:"HTTP",status:"0",name:"节点"};const{code:a}=await VE_API.system.automationNodeStory(e);0===a&&await g(N.value.automation.id)},g=async e=>{const{code:a,data:l}=await VE_API.system.automationFindOne({id:e});0===a&&(N.value.automation=l,console.log(l))};(0,t.bv)((async()=>{let e=(0,i.yj)().query.id;e&&(console.log(e),await g(e))}));return(e,a)=>{const i=(0,t.up)("el-button"),f=(0,t.up)("el-input"),W=(0,t.up)("el-form-item"),L=(0,t.up)("el-switch"),E=(0,t.up)("el-form"),H=(0,t.up)("el-step"),T=(0,t.up)("el-image"),C=(0,t.up)("el-steps"),P=(0,t.up)("el-option"),I=(0,t.up)("el-select"),D=(0,t.up)("el-empty"),O=(0,t.up)("el-row"),S=(0,t.up)("el-drawer");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t._)("div",null,[(0,t.Wm)(i,{onClick:a[0]||(a[0]=e=>N.value.showWhat="info")},{default:(0,t.w5)((()=>[(0,t.Uk)("基础信息")])),_:1}),(0,t.Wm)(i,{onClick:a[1]||(a[1]=e=>N.value.showWhat="node")},{default:(0,t.w5)((()=>[(0,t.Uk)("自动化节点")])),_:1})]),"info"===N.value.showWhat?((0,t.wg)(),(0,t.iD)("div",c,[(0,t.Wm)(E,{model:N.value.automation,ref_key:"formRef",ref:k,rules:d,"label-width":"80px",inline:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{label:"自动化名称",prop:"name"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:N.value.automation.name,"onUpdate:modelValue":a[2]||(a[2]=e=>N.value.automation.name=e),placeholder:"自动化名称",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(W,{label:"处理时间间隔(空不定时处理)",prop:"timeInterval"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:N.value.automation.timeInterval,"onUpdate:modelValue":a[3]||(a[3]=e=>N.value.automation.timeInterval=e),placeholder:"",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(W,{label:"状态",prop:"status"},{default:(0,t.w5)((()=>[(0,t.Wm)(L,{loading:N.value.automation.status,modelValue:e.status,"onUpdate:modelValue":a[4]||(a[4]=a=>e.status=a),"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["loading","modelValue"])])),_:1})])),_:1},8,["model"]),(0,t._)("span",null,[(0,t.Wm)(i,{onClick:a[5]||(a[5]=e=>b())},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(i,{type:"primary",onClick:a[6]||(a[6]=e=>(async()=>{k.value.validate((async e=>{if(e){let e;e="添加"===_.value?await VE_API.system.automationStory(N.value.automation):await VE_API.system.automationStory({id:V.value.id,...N.value.automation});const{code:a}=e;0===a&&b()}}))})())},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])):(0,t.kq)("",!0),"node"===N.value.showWhat?((0,t.wg)(),(0,t.iD)("div",m,[(0,t._)("div",s,[(0,t.Wm)(C,{direction:"vertical",active:1},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{title:"开始节点",icon:(0,o.SU)(r.Picture)},null,8,["icon"]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(N.value.automation.automationNodeList,(e=>((0,t.wg)(),(0,t.j4)(H,{key:e.value,label:e.label,value:e.value,title:e.name,onClick:a=>(e=>{console.log(e),N.value.node.drawer=!0,N.value.currentNode=e,e&&e.automationNodeHttpAction?(N.value.currentAction=e.automationNodeHttpAction,N.value.currentAction.paramList=[],e.automationNodeHttpAction.params?(console.log(e.automationNodeHttpAction.params),Object.keys(e.automationNodeHttpAction.params).forEach((a=>{N.value.currentAction.paramList.push({key:a,val:e.automationNodeHttpAction.params[a]})}))):N.value.currentAction.params={},N.value.currentAction.headerList=[],e.automationNodeHttpAction.headers?Object.keys(e.automationNodeHttpAction.headers).forEach((a=>{N.value.currentAction.headerList.push({key:a,val:e.automationNodeHttpAction.headers[a]})})):N.value.currentAction.headers={}):N.value.currentAction={automationNodeId:N.value.currentNode.id,paramList:[],headerList:[],params:{},headers:{}},console.log(N.value)})(e)},null,8,["label","value","title","onClick"])))),128)),(0,t.Wm)(H,{title:"添加",icon:(0,o.SU)(r.Edit),onClick:U},{default:(0,t.w5)((()=>[(0,t.Wm)(T,{src:l(55102),style:{height:"100%"}},null,8,["src"])])),_:1},8,["icon"]),(0,t.Wm)(H,{title:"结束节点",icon:(0,o.SU)(r.Upload)},null,8,["icon"])])),_:1})])])):(0,t.kq)("",!0),(0,t.Wm)(S,{modelValue:N.value.node.drawer,"onUpdate:modelValue":a[23]||(a[23]=e=>N.value.node.drawer=e),title:"I am the title","with-header":!1},{default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t.Wm)(i,{onClick:a[7]||(a[7]=e=>N.value.showNodeOrAction="node")},{default:(0,t.w5)((()=>[(0,t.Uk)("节点信息")])),_:1}),(0,t.Wm)(i,{onClick:a[8]||(a[8]=e=>N.value.showNodeOrAction="action")},{default:(0,t.w5)((()=>[(0,t.Uk)("节点动作")])),_:1}),"node"===N.value.showNodeOrAction?((0,t.wg)(),(0,t.iD)("div",p,[(0,t.Wm)(E,{model:N.value.currentNode,rules:d,"label-width":"80px",inline:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{label:"节点名称",prop:"name"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:N.value.currentNode.name,"onUpdate:modelValue":a[9]||(a[9]=e=>N.value.currentNode.name=e),placeholder:"节点名称",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(W,{label:"节点排序",prop:"sort"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:N.value.currentNode.sort,"onUpdate:modelValue":a[10]||(a[10]=e=>N.value.currentNode.sort=e),placeholder:"节点排序",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(W,{label:"节点类型",prop:"type"},{default:(0,t.w5)((()=>[(0,t.Wm)(L,{modelValue:N.value.currentNode.type,"onUpdate:modelValue":a[11]||(a[11]=e=>N.value.currentNode.type=e),"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),(0,t._)("span",null,[(0,t.Wm)(i,{onClick:a[12]||(a[12]=e=>(async()=>{const{code:e}=await VE_API.system.automationNodeRemove({id:N.value.currentNode.id});0===e&&await g(N.value.automation.id)})())},{default:(0,t.w5)((()=>[(0,t.Uk)("删除节点")])),_:1}),(0,t.Wm)(i,{type:"primary",onClick:a[13]||(a[13]=e=>(async()=>{const{code:e}=await VE_API.system.automationNodeStory(N.value.currentNode);0===e&&await g(N.value.automation.id)})())},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])):(0,t.kq)("",!0),"action"===N.value.showNodeOrAction?((0,t.wg)(),(0,t.iD)("div",v,[(0,t.Wm)(E,{model:N.value.currentAction,"label-width":"80px",inline:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(W,{label:"动作类型",prop:"automationNodeActionType"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{modelValue:N.value.currentAction.automationNodeActionType,"onUpdate:modelValue":a[14]||(a[14]=e=>N.value.currentAction.automationNodeActionType=e),placeholder:"",clearable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{label:"HTTP",value:"HTTP"})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(W,{label:"请求方式",prop:"httpMethod"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{modelValue:N.value.currentAction.httpMethod,"onUpdate:modelValue":a[15]||(a[15]=e=>N.value.currentAction.httpMethod=e),placeholder:"",clearable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{label:"GET",value:"GET"}),(0,t.Wm)(P,{label:"HEAD",value:"HEAD"}),(0,t.Wm)(P,{label:"POST",value:"POST"}),(0,t.Wm)(P,{label:"PUT",value:"PUT"}),(0,t.Wm)(P,{label:"PATCH",value:"PATCH"}),(0,t.Wm)(P,{label:"DELETE",value:"DELETE"}),(0,t.Wm)(P,{label:"OPTIONS",value:"OPTIONS"}),(0,t.Wm)(P,{label:"TRACE",value:"TRACE"})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(W,{label:"地址",prop:"url"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:N.value.currentAction.url,"onUpdate:modelValue":a[16]||(a[16]=e=>N.value.currentAction.url=e),placeholder:"",clearable:""},null,8,["modelValue"])])),_:1}),(0,t._)("div",null,[w,(0,t.Wm)(i,{onClick:a[17]||(a[17]=e=>(N.value.currentAction,console.log(N.value),void(N.value.currentAction.paramList?N.value.currentAction.paramList.push({}):N.value.currentAction.paramList=[]))),style:{float:"right"},type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("增加 ")])),_:1}),(0,t.wy)((0,t.Wm)(D,null,null,512),[[u.F8,0===N.value.currentAction.paramList.length]]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(N.value.currentAction.paramList,((e,a)=>(0,t.wy)(((0,t.wg)(),(0,t.j4)(O,{key:a},{default:(0,t.w5)((()=>[y,(0,t.Wm)(f,{modelValue:e.key,"onUpdate:modelValue":a=>e.key=a,placeholder:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(f,{modelValue:e.val,"onUpdate:modelValue":a=>e.val=a,placeholder:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)),[[u.F8,N.value.currentAction.paramList]]))),128))]),(0,t.Wm)(W,{label:"请求体",prop:"body"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{modelValue:N.value.currentAction.body,"onUpdate:modelValue":a[18]||(a[18]=e=>N.value.currentAction.body=e),placeholder:"",clearable:""},null,8,["modelValue"])])),_:1}),(0,t._)("div",null,[A,(0,t.Wm)(i,{onClick:a[19]||(a[19]=e=>{N.value.currentAction.headerList?N.value.currentAction.headerList.push({}):N.value.currentAction.paraheaderListmList=[]}),style:{float:"right"},type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("增加 ")])),_:1}),(0,t.wy)((0,t.Wm)(D,null,null,512),[[u.F8,0===N.value.currentAction.headerList.length]]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(N.value.currentAction.headerList,((e,a)=>(0,t.wy)(((0,t.wg)(),(0,t.j4)(O,{key:a},{default:(0,t.w5)((()=>[h,(0,t.Wm)(f,{modelValue:e.key,"onUpdate:modelValue":a=>e.key=a,placeholder:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(f,{modelValue:e.val,"onUpdate:modelValue":a=>e.val=a,placeholder:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)),[[u.F8,N.value.currentAction.headerList]]))),128))])])),_:1},8,["model"]),(0,t.Wm)(O,null,{default:(0,t.w5)((()=>[(0,t._)("span",null," 返回结果 "+(0,n.zw)(N.value.currentAction.result),1)])),_:1}),(0,t._)("span",null,[(0,t.Wm)(i,{onClick:a[20]||(a[20]=e=>(async()=>{const{code:e}=await VE_API.system.automationNodeHttpActionRemove({id:N.value.currentAction.id});0===e&&await g(N.value.automation.id)})())},{default:(0,t.w5)((()=>[(0,t.Uk)("删除节点动作")])),_:1}),(0,t.Wm)(i,{type:"primary",onClick:a[21]||(a[21]=e=>(async()=>{N.value.currentAction.automationNodeId=N.value.currentNode.id;for(let e of N.value.currentAction.paramList)console.log(e.val),N.value.currentAction.params[e.key]=e.val;for(let e of N.value.currentAction.headerList)N.value.currentAction.headers[e.key]=e.val;const{code:e}=await VE_API.system.automationNodeHttpActionStory(N.value.currentAction);0===e&&await g(N.value.automation.id)})())},{default:(0,t.w5)((()=>[(0,t.Uk)("提交节点动作")])),_:1}),(0,t.wy)((0,t.Wm)(i,{type:"primary",onClick:a[22]||(a[22]=e=>(async()=>{const{code:e,data:a}=await VE_API.system.automationNodeHttpActionExecuteOne({actionId:N.value.currentAction.id});0===e&&(N.value.currentAction.result=a,console.log(a))})())},{default:(0,t.w5)((()=>[(0,t.Uk)("执行动作")])),_:1},512),[[u.F8,N.value.currentAction.id]])])])):(0,t.kq)("",!0)])])),_:1},8,["modelValue"])],64)}}};var W=(0,l(48118).Z)(f,[["__scopeId","data-v-90f2bb06"]])},55102:function(e,a,l){e.exports=l.p+"img/redis.37644815.png"}}]);