"use strict";(self.webpackChunklazy_ui=self.webpackChunklazy_ui||[]).push([[3616],{63616:function(e,l,a){a.r(l),a.d(l,{default:function(){return i}});a(70560);var t=a(66252),n=a(2262),m=a(3577),u=a(22201);const o={data:()=>({description:"数据库表字段设置",buttons:{del:{name:"删除字段"}}})};var i=Object.assign(o,{__name:"DatabaseTableEdit",props:{showDialog:{type:Boolean,default:!0},title:{type:String,default:"添加"},rowData:{type:Object,default:null}},setup(e){const l={instanceId:[{required:!0,message:"请选择数据库实例",trigger:"blur"}],characterSet:[{required:!0,message:"请输入字符集",trigger:"blur"}],sortingRules:[{required:!0,message:"请输入排序规则",trigger:"blur"}],ext:[{required:!0,message:"ext",trigger:"change"}]},a=e,{title:o,rowData:i}=(0,n.BK)(a),d=()=>{D.back()},r=(0,n.iH)(null),b=(0,n.qj)({id:"",schemaName:"",instanceName:"",instanceId:"",engine:"InnoDB",autoIncrement:"",tableComment:"",tableName:"",tableCatalog:"",tableRows:"",tableCollation:"",maxDataLength:"",indexLength:"",dataLength:"",avgRowLength:"",createOptions:"",checkTime:"",checksum:"",dataFree:"",rowFormat:"",tableType:"",createTime:"",updateTime:"",version:"",tableColumnList:(0,n.iH)([]),tableColumnIndexList:(0,n.iH)([])}),{id:c,schemaName:s,instanceName:p,instanceId:v,engine:g,autoIncrement:W,tableComment:w,tableName:h,tableCatalog:y,tableRows:V,tableCollation:f,maxDataLength:C,indexLength:_,dataLength:L,avgRowLength:x,createOptions:N,checkTime:U,checksum:I,dataFree:T,rowFormat:k,tableType:E,createTime:A,updateTime:R,version:S}=(0,n.BK)(b);i.value&&(s.value=i.value.schemaName,c.value=i.value.id,p.value=i.value.instanceName,v.value=i.value.instanceId,g.value=i.value.engine,W.value=i.value.autoIncrement,w.value=i.value.tableComment,h.value=i.value.tableName,y.value=i.value.tableCatalog,V.value=i.value.tableRows,f.value=i.value.tableCollation,C.value=i.value.maxDataLength,_.value=i.value.indexLength,L.value=i.value.dataLength,x.value=i.value.avgRowLength,N.value=i.value.createOptions,U.value=i.value.checkTime,I.value=i.value.checksum,T.value=i.value.dataFree,k.value=i.value.rowFormat,E.value=i.value.tableType,A.value=i.value.createTime,R.value=i.value.updateTime,S.value=i.value.version);const M=(0,n.iH)(null),H=(0,n.iH)(null),D=(0,u.tv)(),O=(0,n.iH)("first"),F=async(e,l)=>{console.log(e,l)},P=()=>{let e=H.value.find((e=>e.id===b.instanceId));b.instanceName=e.instanceName,r.value.validate((async e=>{if(!e)return console.log("error submit!!"),!1;{let e;e="添加"===o.value?await VE_API.system.tableAdd(b):await VE_API.system.tableAdd({id:i.value.id,...b});const{code:l}=e;0===l&&D.go(-1)}}))},q=async e=>{if(null==e)return;let l=await VE_API.system.schemaList({instanceId:e});const{code:a}=l;0===a&&(l.data.map((e=>{e.label=e.schemaName,e.value=e.schemaName})),M.value=l.data?l.data:[])},B=async(e,l,a)=>{let t=await VE_API.system.databaseTableColumnList({instanceId:e,schemaName:l,tableName:a});const{code:n,data:m}=t;if(0===n){const{acwTableColumnDTOList:e,acwTableColumnIndexDTOList:l}=m;e&&e.length>0&&(e.map((e=>{e.label=e.columnName,e.value=e.columnName})),b.tableColumnList=e||[],b.tableColumnIndexList=l)}},Y=async({row:e,rowIndex:l})=>{e.index=l};return(0,t.bv)((async()=>{let e=(0,u.yj)().query;await(async e=>{let l=e.instanceId;""!==l&&void 0!==l&&(b.schemaName=e.schemaName,b.instanceId=e.instanceId,b.instanceName=e.instanceName,b.engine=e.engine,b.autoIncrement=e.autoIncrement,b.tableComment=e.tableComment,b.tableName=e.tableName,b.tableCatalog=e.tableCatalog,b.tableRows=e.tableRows,b.tableCollation=e.tableCollation,b.maxDataLength=e.maxDataLength,b.indexLength=e.indexLength,b.dataLength=e.dataLength,b.avgRowLength=e.avgRowLength,b.createOptions=e.createOptions,b.checkTime=e.checkTime,b.checksum=e.checksum,b.dataFree=e.dataFree,b.rowFormat=e.rowFormat,b.tableType=e.tableType,b.createTime=e.createTime,b.updateTime=e.updateTime,b.version=e.version,b.instanceId=l,null===b.instanceId||""===b.instanceId||void 0===b.instanceId||isNaN(b.instanceId)||await q(b.instanceId),null!==b.tableName&&""!==b.tableName&&void 0!==b.tableName&&await B(b.instanceId,b.schemaName,b.tableName))})(e),await(async()=>{VE_API.system.databaseInstanceList().then((e=>{e.data.map((e=>{e.label=e.instanceName,e.value=e.id})),H.value=e.data?e.data:[]}))})()})),(e,a)=>{const u=(0,t.up)("el-option"),o=(0,t.up)("el-select"),i=(0,t.up)("el-descriptions-item"),c=(0,t.up)("el-input"),p=(0,t.up)("el-descriptions"),W=(0,t.up)("el-table-column"),y=(0,t.up)("el-button"),V=(0,t.up)("ve-table"),f=(0,t.up)("el-form"),C=(0,t.up)("el-tab-pane"),_=(0,t.up)("el-tabs");return(0,t.wg)(),(0,t.iD)(t.HY,null,[(0,t.Wm)(p,{title:"数据库表信息",column:4,border:""},{default:(0,t.w5)((()=>[(0,t.Wm)(i,{label:"数据库实例","label-align":"right",align:"center",property:"instanceId"},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{modelValue:(0,n.SU)(v),"onUpdate:modelValue":a[0]||(a[0]=e=>(0,n.dq)(v)?v.value=e:null),onChange:q,placeholder:"数据库实例",filterable:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(H.value,(e=>((0,t.wg)(),(0,t.j4)(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"数据库名","label-align":"right",align:"center","label-class-name":"my-label","class-name":"my-content",width:"150px"},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{clearable:"",modelValue:(0,n.SU)(s),"onUpdate:modelValue":a[1]||(a[1]=e=>(0,n.dq)(s)?s.value=e:null),placeholder:"数据库名",onChange:e.getDataList,filterable:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(M.value,(e=>((0,t.wg)(),(0,t.j4)(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),(0,t.Wm)(i,{label:"表名称","label-align":"right",align:"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:(0,n.SU)(h),"onUpdate:modelValue":a[2]||(a[2]=e=>(0,n.dq)(h)?h.value=e:null),placeholder:"tableName",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"表引擎","label-align":"right",align:"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(o,{modelValue:(0,n.SU)(g),"onUpdate:modelValue":a[3]||(a[3]=e=>(0,n.dq)(g)?g.value=e:null),placeholder:"表引擎",filterable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{label:"ARCHIVE",value:"ARCHIVE"}),(0,t.Wm)(u,{label:"BLACKHOLE",value:"BLACKHOLE"}),(0,t.Wm)(u,{label:"CSV",value:"CSV"}),(0,t.Wm)(u,{label:"InnoDB",value:"InnoDB"}),(0,t.Wm)(u,{label:"MEMORY",value:"MEMORY"}),(0,t.Wm)(u,{label:"MRG_MYISAM",value:"MRG_MYISAM"}),(0,t.Wm)(u,{label:"MyISAM",value:"MyISAM"}),(0,t.Wm)(u,{label:"PERFORMANCE_SCHEMA",value:"PERFORMANCE_SCHEMA"})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(i,{label:"表描述","label-align":"right",align:"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{modelValue:(0,n.SU)(w),"onUpdate:modelValue":a[4]||(a[4]=e=>(0,n.dq)(w)?w.value=e:null),placeholder:"tableComment",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),(0,t.Wm)(_,{modelValue:O.value,"onUpdate:modelValue":a[11]||(a[11]=e=>O.value=e),type:"card",class:"demo-tabs",onTabClick:F},{default:(0,t.w5)((()=>[(0,t.Wm)(C,{label:"字段",name:"first"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{model:b,ref_key:"formRef",ref:r,rules:l,"label-width":"80px",inline:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{table:{data:b.tableColumnList},rules:l,style:{width:"100%"},"row-class-name":Y},{tool_bar:(0,t.w5)((()=>[(0,t.Wm)(y,{onClick:a[5]||(a[5]=e=>{b.tableColumnList.push({})}),style:{float:"right"},type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("增加")])),_:1}),(0,t.Wm)(y,{onClick:a[6]||(a[6]=e=>d())},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(y,{type:"primary",onClick:a[7]||(a[7]=e=>P())},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])),default:(0,t.w5)((()=>[(0,t.Wm)(W,{prop:"columnName",label:"字段名称",sortable:""},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.columnName,"onUpdate:modelValue":l=>e.columnName=l,placeholder:"columnName",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"dataType",label:"类型"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(o,{modelValue:e.dataType,"onUpdate:modelValue":l=>e.dataType=l,placeholder:"字段类型",filterable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{label:"bigint",value:"bigint"}),(0,t.Wm)(u,{label:"binary",value:"binary"}),(0,t.Wm)(u,{label:"bit",value:"bit"}),(0,t.Wm)(u,{label:"blob",value:"blob"}),(0,t.Wm)(u,{label:"char",value:"char"}),(0,t.Wm)(u,{label:"date",value:"date"}),(0,t.Wm)(u,{label:"datetime",value:"datetime"}),(0,t.Wm)(u,{label:"decimal",value:"decimal"}),(0,t.Wm)(u,{label:"double",value:"double"}),(0,t.Wm)(u,{label:"enum",value:"enum"}),(0,t.Wm)(u,{label:"float",value:"float"}),(0,t.Wm)(u,{label:"geometry",value:"geometry"}),(0,t.Wm)(u,{label:"geometrycollection",value:"geometrycollection"}),(0,t.Wm)(u,{label:"int",value:"int"}),(0,t.Wm)(u,{label:"integer",value:"integer"}),(0,t.Wm)(u,{label:"json",value:"json"}),(0,t.Wm)(u,{label:"linestring",value:"linestring"}),(0,t.Wm)(u,{label:"longblob",value:"longblob"}),(0,t.Wm)(u,{label:"longtext",value:"longtext"}),(0,t.Wm)(u,{label:"mediumblob",value:"mediumblob"}),(0,t.Wm)(u,{label:"mediumint",value:"mediumint"}),(0,t.Wm)(u,{label:"mediumtext",value:"mediumtext"}),(0,t.Wm)(u,{label:"multilinestring",value:"multilinestring"}),(0,t.Wm)(u,{label:"multipoint",value:"multipoint"}),(0,t.Wm)(u,{label:"multipolygon",value:"multipolygon"}),(0,t.Wm)(u,{label:"numeric",value:"numeric"}),(0,t.Wm)(u,{label:"point",value:"point"}),(0,t.Wm)(u,{label:"polygon",value:"polygon"}),(0,t.Wm)(u,{label:"real",value:"real"}),(0,t.Wm)(u,{label:"set",value:"set"}),(0,t.Wm)(u,{label:"smallint",value:"smallint"}),(0,t.Wm)(u,{label:"text",value:"text"}),(0,t.Wm)(u,{label:"time",value:"time"}),(0,t.Wm)(u,{label:"timestamp",value:"timestamp"}),(0,t.Wm)(u,{label:"tinyblob",value:"tinyblob"}),(0,t.Wm)(u,{label:"tinyint",value:"tinyint"}),(0,t.Wm)(u,{label:"tinytext",value:"tinytext"}),(0,t.Wm)(u,{label:"varbinary",value:"varbinary"}),(0,t.Wm)(u,{label:"varchar",value:"varchar"}),(0,t.Wm)(u,{label:"year",value:"year"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"characterMaximumLength",label:"字段长度"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.characterMaximumLength,"onUpdate:modelValue":l=>e.characterMaximumLength=l,placeholder:"characterMaximumLength",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"columnType",label:"字段类型",sortable:""},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.columnType,"onUpdate:modelValue":l=>e.columnType=l,placeholder:"columnType",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"generationExpression",label:"小数点"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.generationExpression,"onUpdate:modelValue":l=>e.generationExpression=l,placeholder:"generationExpression",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"isNullable",label:"不是null"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(o,{modelValue:e.isNullable,"onUpdate:modelValue":l=>e.isNullable=l,placeholder:"不是null"},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{label:"YES",value:"YES"}),(0,t.Wm)(u,{label:"NO",value:"NO"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"numericPrecision",label:"虚拟"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.numericPrecision,"onUpdate:modelValue":l=>e.numericPrecision=l,placeholder:"numericPrecision",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"numericScale",label:"键"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.numericScale,"onUpdate:modelValue":l=>e.numericScale=l,placeholder:"numericScale",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"columnComment",label:"描述"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.columnComment,"onUpdate:modelValue":l=>e.columnComment=l,placeholder:"columnComment",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{fixed:"right",label:"操作"},{default:(0,t.w5)((({$index:l})=>[(0,t.Wm)(y,{onClick:e=>{return a=l,void b.tableColumnList.splice(a,1);var a},style:{float:"right"},type:"danger",size:"small"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,m.zw)(e.buttons.del.name),1)])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["table"])])),_:1},8,["model"])])),_:1}),(0,t.Wm)(C,{label:"索引",name:"second"},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{table:{data:b.tableColumnIndexList},rules:l,style:{width:"100%"},"row-class-name":Y},{tool_bar:(0,t.w5)((()=>[(0,t.Wm)(y,{onClick:a[8]||(a[8]=e=>{b.tableColumnIndexList.push({})}),style:{float:"right"},type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("增加")])),_:1}),(0,t.Wm)(y,{onClick:a[9]||(a[9]=e=>d())},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(y,{type:"primary",onClick:a[10]||(a[10]=e=>P())},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])),default:(0,t.w5)((()=>[(0,t.Wm)(W,{prop:"indexName",label:"索引名称",sortable:""},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.indexName,"onUpdate:modelValue":l=>e.indexName=l,placeholder:"indexName",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"columnNameList",label:"索引字段"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(o,{modelValue:e.columnNameList,"onUpdate:modelValue":l=>e.columnNameList=l,placeholder:"索引字段",filterable:"",multiple:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(b.tableColumnList,(e=>((0,t.wg)(),(0,t.j4)(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"indexType",label:"索引类型"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(o,{modelValue:e.indexType,"onUpdate:modelValue":l=>e.indexType=l,placeholder:"索引类型",filterable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{label:"FULLTEXT",value:"FULLTEXT"}),(0,t.Wm)(u,{label:"NORMAL",value:"NORMAL"}),(0,t.Wm)(u,{label:"SPATIAL",value:"SPATIAL"}),(0,t.Wm)(u,{label:"UNIQUE",value:"UNIQUE"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"indexType",label:"索引方法"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(o,{modelValue:e.indexType,"onUpdate:modelValue":l=>e.indexType=l,placeholder:"索引方法",filterable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(u,{label:"BTREE",value:"BTREE "}),(0,t.Wm)(u,{label:"HASH",value:"HASH"})])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{prop:"indexComment",label:"注释"},{default:(0,t.w5)((({row:e})=>[(0,t.Wm)(c,{modelValue:e.indexComment,"onUpdate:modelValue":l=>e.indexComment=l,placeholder:"索引注释"},null,8,["modelValue","onUpdate:modelValue"])])),_:1}),(0,t.Wm)(W,{fixed:"right",label:"操作"},{default:(0,t.w5)((({$index:l})=>[(0,t.Wm)(y,{onClick:e=>{return a=l,void b.tableColumnIndexList.splice(a,1);var a},style:{float:"right"},type:"danger",size:"small"},{default:(0,t.w5)((()=>[(0,t.Uk)((0,m.zw)(e.buttons.del.name),1)])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["table"])])),_:1})])),_:1},8,["modelValue"])],64)}}})}}]);