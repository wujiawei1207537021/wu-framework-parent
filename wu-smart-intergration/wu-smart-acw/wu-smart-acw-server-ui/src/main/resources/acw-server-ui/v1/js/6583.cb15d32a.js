"use strict";(self.webpackChunklazy_ui=self.webpackChunklazy_ui||[]).push([[6583],{76583:function(l,e,a){a.r(e),a.d(e,{default:function(){return h}});a(70560);var t=a(66252),u=a(2262),o=a(3577),n=a(49963);const d=l=>((0,t.dD)("data-v-2850fb61"),l=l(),(0,t.Cn)(),l),m={style:{"text-align":"center"},class:"api_transfer_result"},i={style:{float:"left"}},p={style:{float:"right"}},v=d((()=>(0,t._)("span",null,"路径参数",-1))),r={style:{float:"left"}},s={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},c=d((()=>(0,t._)("span",null,"请求参数",-1))),f={style:{float:"left"}},b={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},g=d((()=>(0,t._)("span",null,"请求体参数",-1))),_={style:{float:"left"}},w={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}};var y={__name:"ApiFactoryEdit",props:{showDialog:{type:Boolean,default:!0},title:{type:String,default:"添加"},rowData:{type:Object,default:null}},emits:["closeDialog"],setup(l,{emit:e}){const a={applicationId:[{required:!0,message:"请选择应用名称",trigger:"blur"}],tableNameList:[{required:!0,message:"请选择表",trigger:"blur"}],tag:[{required:!0,message:"请输入接口分组",trigger:"blur"}],description:[{required:!0,message:"请输入接口描述",trigger:"change"}],method:[{required:!0,message:"请选择接口类型",trigger:"change"}],path:[{required:!0,message:"请选择接口地址",trigger:"change"}]},d=l,y=e,{title:h,rowData:W}=(0,u.BK)(d),V=()=>{y("closeDialog",!1)},k=(0,u.iH)(null),U=(0,u.iH)(null),E=(0,u.iH)(null),P=(0,u.iH)([]),A=(0,u.iH)({leftValue:[]}),T=(0,u.iH)([]),C=(0,u.iH)([]),N=(0,u.iH)([]),H=(0,u.iH)(),D=(0,u.qj)({applicationId:"",tableNameList:[],tag:"",description:"",method:"",path:"",apiParamQoList:[]}),{applicationId:I,tableNameList:S,tag:Y,description:z,method:R,path:L,apiParamQoList:O}=(0,u.BK)(D);W.value&&(I.value=W.value.applicationId,Y.value=W.value.tag,z.value=W.value.description,R.value=W.value.method,L.value=W.value.path,O.value=W.value.apiParamQoList,S.value=W.value.tableNameList);const q=l=>{console.log(l)};(0,t.bv)((async()=>{VE_API.system.applicationList().then((l=>{l.data.map((l=>{l.label=l.applicationName,l.value=l.applicationId})),U.value=l.data?l.data:[];let e=l.data.find((l=>l.applicationId===I.value));e&&(K(e.applicationId),Q(D.tableNameList))})),null!==O.value&&O.value.length>0&&(C.value=O.value.filter((l=>"PATH_PARAM_TYPE"===l.type)),T.value=O.value.filter((l=>"REQUEST_BODY_PARAM_TYPE"===l.type)),N.value=O.value.filter((l=>"REQUEST_PARAM_TYPE"===l.type))),await Q(S)}));const j=l=>{let e=U.value.find((e=>e.applicationId===l));H.value=e,console.log(e),K(e.applicationId)},x=l=>{null!=l&&0!==l.length&&Q(l)},K=async l=>{null!=l&&VE_API.system.applicationFindTables({applicationId:l}).then((l=>{l.data.map((l=>{l.label=l.tableName,l.value=l.tableName})),E.value=l.data?l.data:[]}))},Q=async l=>{if(console.log(l),console.log(H.value),void 0===l||0===l.length||void 0===l.length||void 0===H.value)return;let e=l.join();VE_API.system.databaseTablesColumnList({instanceId:H.value.instanceId,schemaName:H.value.schemaName,tableNameList:e}).then((l=>{l.data.map((l=>{l.label=l.columnName,l.value=l.columnName})),P.value=l.data?l.data:[]})),l.value=l,console.log(P)},M=(l,e=null)=>{console.log(e),console.log(C.value),console.log(T.value),console.log(N.value),"PATH_PARAM_TYPE"===e?C.value.push({type:e}):"REQUEST_BODY_PARAM_TYPE"===e?T.value.push({type:e}):"REQUEST_PARAM_TYPE"===e&&N.value.push({type:e})},B=(l,e)=>{l.splice(e,1)};return(e,d)=>{const y=(0,t.up)("el-option"),H=(0,t.up)("el-select"),O=(0,t.up)("el-form-item"),K=(0,t.up)("el-input"),Q=(0,t.up)("el-button"),F=(0,t.up)("el-transfer"),$=(0,t.up)("el-empty"),G=(0,t.up)("el-form"),J=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.j4)(J,{title:(0,u.SU)(h),"append-to-body":"","destroy-on-close":"","model-value":l.showDialog,width:"80%",onClose:d[12]||(d[12]=l=>V())},{footer:(0,t.w5)((()=>[(0,t._)("span",null,[(0,t.Wm)(Q,{onClick:d[10]||(d[10]=l=>V())},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(Q,{type:"primary",onClick:d[11]||(d[11]=l=>(()=>{let l=[];l=l.concat(C.value),l=l.concat(T.value),l=l.concat(N.value),l=JSON.parse(JSON.stringify(l)),D.apiParamQoList=l,D.apiResultList=A.value.leftValue,console.log(A),k.value.validate((async l=>{if(!l)return console.log("error submit!!"),!1;{let l;l="添加"===h.value?await VE_API.system.apiAdd(D):await VE_API.system.apiEdit({id:W.value.id,...D});const{code:e}=l;0===e&&V()}}))})())},{default:(0,t.w5)((()=>[(0,t.Uk)("确定")])),_:1})])])),default:(0,t.w5)((()=>[(0,t.Wm)(G,{model:D,ref_key:"formRef",ref:k,rules:a,"label-width":"80px",inline:!1},{default:(0,t.w5)((()=>[(0,t.Wm)(O,{label:"应用名称",prop:"applicationId"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:(0,u.SU)(I),"onUpdate:modelValue":d[0]||(d[0]=l=>(0,u.dq)(I)?I.value=l:null),placeholder:"应用名称",onChange:j,clearable:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(U.value,(l=>((0,t.wg)(),(0,t.j4)(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(O,{label:"数据库表",prop:"tableNameList"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:(0,u.SU)(S),"onUpdate:modelValue":d[1]||(d[1]=l=>(0,u.dq)(S)?S.value=l:null),placeholder:"数据库表",onChange:x,multiple:"",clearable:""},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(E.value,(l=>((0,t.wg)(),(0,t.j4)(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(O,{label:"接口分组",prop:"tag"},{default:(0,t.w5)((()=>[(0,t.Wm)(K,{modelValue:(0,u.SU)(Y),"onUpdate:modelValue":d[2]||(d[2]=l=>(0,u.dq)(Y)?Y.value=l:null),placeholder:"",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(O,{label:"接口描述",prop:"description"},{default:(0,t.w5)((()=>[(0,t.Wm)(K,{modelValue:(0,u.SU)(z),"onUpdate:modelValue":d[3]||(d[3]=l=>(0,u.dq)(z)?z.value=l:null),placeholder:"",clearable:""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(O,{label:"接口类型",prop:"method"},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:(0,u.SU)(R),"onUpdate:modelValue":d[4]||(d[4]=l=>(0,u.dq)(R)?R.value=l:null),placeholder:"",clearable:""},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{label:"GET",value:"GET"}),(0,t.Wm)(y,{label:"HEAD",value:"HEAD"}),(0,t.Wm)(y,{label:"POST",value:"POST"}),(0,t.Wm)(y,{label:"PUT",value:"PUT"}),(0,t.Wm)(y,{label:"PATCH",value:"PATCH"}),(0,t.Wm)(y,{label:"DELETE",value:"DELETE"}),(0,t.Wm)(y,{label:"OPTIONS",value:"OPTIONS"}),(0,t.Wm)(y,{label:"TRACE",value:"TRACE"})])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(O,{label:"接口地址",prop:"path"},{default:(0,t.w5)((()=>[(0,t.Wm)(K,{modelValue:(0,u.SU)(L),"onUpdate:modelValue":d[5]||(d[5]=l=>(0,u.dq)(L)?L.value=l:null),placeholder:"",clearable:""},null,8,["modelValue"])])),_:1}),(0,t._)("div",m,[(0,t.Wm)(F,{modelValue:A.value.leftValue,"onUpdate:modelValue":d[6]||(d[6]=l=>A.value.leftValue=l),style:{"text-align":"left",display:"inline-block"},filterable:"","left-default-checked":[2,3],"right-default-checked":[1],titles:["原始数据","接口返回数据"],"button-texts":["移除返回数据","添加返回数据"],data:P.value,props:{key:"value",label:"desc"},format:{noChecked:"${total}",hasChecked:"${checked}/${total}"},onChange:q},{default:(0,t.w5)((({option:l})=>[(0,t._)("span",i,(0,o.zw)(l.label)+" 【"+(0,o.zw)(l.columnComment)+"】 ",1),(0,t._)("span",p,(0,o.zw)(l.tableName),1)])),"left-footer":(0,t.w5)((()=>[(0,t.Wm)(Q,{class:"transfer-footer",size:"small"},{default:(0,t.w5)((()=>[(0,t.Uk)("Operation")])),_:1})])),"right-footer":(0,t.w5)((()=>[(0,t.Wm)(Q,{class:"transfer-footer",size:"small"},{default:(0,t.w5)((()=>[(0,t.Uk)("Operation")])),_:1})])),_:1},8,["modelValue","data"])]),(0,t._)("div",null,[v,(0,t.Wm)(Q,{onClick:d[7]||(d[7]=l=>M(C.value,"PATH_PARAM_TYPE")),type:"primary",style:{float:"right"}},{default:(0,t.w5)((()=>[(0,t.Uk)("增加 ")])),_:1}),(0,t.wy)((0,t.Wm)($,null,null,512),[[n.F8,0===C.value.length]]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(C.value,((l,e)=>((0,t.wg)(),(0,t.j4)(O,{key:e},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:C.value[e].columnName,"onUpdate:modelValue":l=>C.value[e].columnName=l,placeholder:"路径参数选择"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(P.value,(l=>((0,t.wg)(),(0,t.j4)(y,{key:l.value,label:l.label,value:l.value},{default:(0,t.w5)((()=>[(0,t._)("span",r,(0,o.zw)(l.label)+"【"+(0,o.zw)(l.columnComment)+"】",1),(0,t._)("span",s,(0,o.zw)(l.tableName),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(H,{modelValue:C.value[e].term,"onUpdate:modelValue":l=>C.value[e].term=l,placeholder:"条件(大于、等于、模糊)"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{label:"小等于",value:"<"}),(0,t.Wm)(y,{label:"等于",value:"="}),(0,t.Wm)(y,{label:"大于等于",value:">="}),(0,t.Wm)(y,{label:"小于等于",value:"<="}),(0,t.Wm)(y,{label:"不等于",value:"!="}),(0,t.Wm)(y,{label:"模糊查询",value:"like"}),(0,t.Wm)(y,{label:"in",value:"in"})])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(Q,{onClick:l=>B(C.value,e),type:"danger",style:{float:"right"}},{default:(0,t.w5)((()=>[(0,t.Uk)("删除 ")])),_:2},1032,["onClick"])])),_:2},1024)))),128))]),(0,t._)("div",null,[c,(0,t.Wm)(Q,{onClick:d[8]||(d[8]=l=>M(N.value,"REQUEST_PARAM_TYPE")),style:{float:"right"},type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("增加 ")])),_:1}),(0,t.wy)((0,t.Wm)($,null,null,512),[[n.F8,0===N.value.length]]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(N.value,((l,e)=>((0,t.wg)(),(0,t.j4)(O,{key:e},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:N.value[e].columnName,"onUpdate:modelValue":l=>N.value[e].columnName=l,placeholder:"请求参数选择"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(P.value,(l=>((0,t.wg)(),(0,t.j4)(y,{key:l.value,label:l.label,value:l.value},{default:(0,t.w5)((()=>[(0,t._)("span",f,(0,o.zw)(l.label)+"【"+(0,o.zw)(l.columnComment)+"】",1),(0,t._)("span",b,(0,o.zw)(l.tableName),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(H,{modelValue:N.value[e].term,"onUpdate:modelValue":l=>N.value[e].term=l,placeholder:"条件(大于、等于、模糊)"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{label:"小等于",value:"<"}),(0,t.Wm)(y,{label:"等于",value:"="}),(0,t.Wm)(y,{label:"大于等于",value:">="}),(0,t.Wm)(y,{label:"小于等于",value:"<="}),(0,t.Wm)(y,{label:"不等于",value:"!="}),(0,t.Wm)(y,{label:"模糊查询",value:"like"}),(0,t.Wm)(y,{label:"in",value:"in"})])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(Q,{onClick:l=>B(N.value,e),style:{float:"right"},type:"danger"},{default:(0,t.w5)((()=>[(0,t.Uk)("删除 ")])),_:2},1032,["onClick"])])),_:2},1024)))),128))]),(0,t._)("div",null,[g,(0,t.Wm)(Q,{onClick:d[9]||(d[9]=l=>M(T.value,"REQUEST_BODY_PARAM_TYPE")),style:{float:"right"},type:"primary"},{default:(0,t.w5)((()=>[(0,t.Uk)("增加 ")])),_:1}),(0,t.wy)((0,t.Wm)($,null,null,512),[[n.F8,0===T.value.length]]),((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(T.value,((l,e)=>((0,t.wg)(),(0,t.j4)(O,{key:e},{default:(0,t.w5)((()=>[(0,t.Wm)(H,{modelValue:T.value[e].columnName,"onUpdate:modelValue":l=>T.value[e].columnName=l,placeholder:"请选择"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(P.value,(l=>((0,t.wg)(),(0,t.j4)(y,{key:l.value,label:l.label,value:l.value},{default:(0,t.w5)((()=>[(0,t._)("span",_,(0,o.zw)(l.label)+"【"+(0,o.zw)(l.columnComment)+"】",1),(0,t._)("span",w,(0,o.zw)(l.tableName),1)])),_:2},1032,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(H,{modelValue:T.value[e].term,"onUpdate:modelValue":l=>T.value[e].term=l,placeholder:"条件(大于、等于、模糊)"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{label:"大于",value:">"}),(0,t.Wm)(y,{label:"小等于",value:"<"}),(0,t.Wm)(y,{label:"等于",value:"="}),(0,t.Wm)(y,{label:"大于等于",value:">="}),(0,t.Wm)(y,{label:"小于等于",value:"<="}),(0,t.Wm)(y,{label:"不等于",value:"!="}),(0,t.Wm)(y,{label:"模糊查询",value:"like"}),(0,t.Wm)(y,{label:"in",value:"in"})])),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,t.Wm)(Q,{onClick:l=>B(T.value,e),type:"danger",style:{float:"right"}},{default:(0,t.w5)((()=>[(0,t.Uk)("删除 ")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])])),_:1},8,["model"])])),_:1},8,["title","model-value"])}}};var h=(0,a(48118).Z)(y,[["__scopeId","data-v-2850fb61"]])}}]);